"use client";
import { useChat } from "@ai-sdk/react";
import { unstable_useCloudThreadListAdapter, unstable_useRemoteThreadListRuntime, useAuiState, } from "@assistant-ui/react";
import { useAISDKRuntime, } from "./useAISDKRuntime.js";
import { AssistantChatTransport } from "./AssistantChatTransport.js";
import { useEffect, useMemo, useRef } from "react";
const useDynamicChatTransport = (transport) => {
    const transportRef = useRef(transport);
    useEffect(() => {
        transportRef.current = transport;
    });
    const dynamicTransport = useMemo(() => new Proxy(transportRef.current, {
        get(_, prop) {
            const res = transportRef.current[prop];
            return typeof res === "function"
                ? res.bind(transportRef.current)
                : res;
        },
    }), []);
    return dynamicTransport;
};
const useChatThreadRuntime = (options) => {
    const { adapters, transport: transportOptions, toCreateMessage, ...chatOptions } = options ?? {};
    const transport = useDynamicChatTransport(transportOptions ?? new AssistantChatTransport());
    const id = useAuiState(({ threadListItem }) => threadListItem.id);
    const chat = useChat({
        ...chatOptions,
        id,
        transport,
    });
    const runtime = useAISDKRuntime(chat, {
        adapters,
        ...(toCreateMessage && { toCreateMessage }),
    });
    if (transport instanceof AssistantChatTransport) {
        transport.setRuntime(runtime);
    }
    return runtime;
};
export const useChatRuntime = ({ cloud, ...options } = {}) => {
    const cloudAdapter = unstable_useCloudThreadListAdapter({ cloud });
    return unstable_useRemoteThreadListRuntime({
        runtimeHook: function RuntimeHook() {
            return useChatThreadRuntime(options);
        },
        adapter: cloudAdapter,
        allowNesting: true,
    });
};
//# sourceMappingURL=useChatRuntime.js.map